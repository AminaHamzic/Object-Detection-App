<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Object Detection App</title>
    <link href="https://fonts.googleapis.com/css?family=K2D:300,400,500,700,800" rel="stylesheet">
    <link rel="stylesheet" href="./static/css/bootstrap.css">
    <link href="https://unpkg.com/dropzone@6.0.0-beta.1/dist/dropzone.css" rel="stylesheet" type="text/css" />
</head>
<body>

<section class="bg-gradient pt-5 pb-6">
    <div class="container">
        <div class="row">
            <div class="col-12 d-flex flex-row align-items-center justify-content-between">
                <div class="heading-brand">Object Detection App</div>
                <a href="https://github.com/AminaHamzic/Object-Detection-App" class="btn btn-dark" target="_blank">GitHub</a>
            </div>
        </div>
        <div class="row mt-6">
            <div class="col-md-8 mx-auto text-center">
                <h1>How to use it?</h1>
                <p class="lead"><strong>1. Upload your image or video</strong></p>
                <p class="lead"><strong>2. Wait for the media to be processed</strong></p>
                <p class="lead"><strong>3. View the results below</strong></p>
            </div>
        </div>
        <div class="card">
            <div class="col-md-12 d-flex">
                <div class="sidebar">
                    <div class="sidebar-content">
                        <h3>Image/Video Configuration</h3>
                        <p>Choose an image or video...</p>
                        <div class="upload-instructions">
                            <p>Drag and drop file here or click to select</p>
                            <p>Limit 200MB per file - JPG, JPEG, PNG, MP4</p>
                        </div>
                        <form id="image-dropzone" class="dropzone"></form>
                        <form id="video-dropzone" class="dropzone"></form>
                        <div class="model-confidence-slider">
                            <label for="model-confidence">Select Model Confidence</label>
                            <input type="range" id="model-confidence" name="confidence" min="0" max="100" value="50">
                        </div>
                    </div>
                </div>
                <div class="object-detection-area">
                    <h3>Results will appear here:</h3>
                    <img id="display_image" src="" alt="Uploaded Image" style="max-width: 100%; display: none;">
                    <img id="display_video" style="max-width: 100%; display: none;">
                </div>
            </div>
        </div>
    </div>
</section>

<script src="/static/js/scripts.js"></script>
<script src="https://unpkg.com/dropzone@6.0.0-beta.1/dist/dropzone-min.js"></script>
<script>
    const baseUrl = window.location.origin;

    let imageDropzone = new Dropzone("#image-dropzone", {
        url: `${baseUrl}/upload_image/`,
        paramName: 'file_upload',
        maxFilesize: 200,
        acceptedFiles: 'image/*',
        init: function() {
            this.on("sending", function(file, xhr, formData) {
                let confidence = document.getElementById('model-confidence').value / 100;
                formData.append("confidence", confidence);
            });
            this.on("success", function(file, response) {
                if (response.base64_image) {
                    document.getElementById('display_image').src = 'data:image/png;base64,' + response.base64_image;
                    document.getElementById('display_image').style.display = 'block';
                    document.getElementById('display_video').style.display = 'none';
                } else {
                    console.error('No image data provided in the response');
                }
            });
            this.on("error", function(file, response) {
                console.error('Error during file upload: ' + response);
            });
        }
    });

    let videoDropzone = new Dropzone("#video-dropzone", {
        url: `${baseUrl}/upload_video/`,
        paramName: 'file_upload',
        maxFilesize: 200,
        acceptedFiles: 'video/*',
        init: function() {
            this.on("sending", function(file, xhr, formData) {
                let confidence = document.getElementById('model-confidence').value / 100;
                formData.append("confidence", confidence);
            });
            this.on("success", function(file, response) {
                if (response.video_id) {
                    let confidence = document.getElementById('model-confidence').value / 100;
                    document.getElementById('display_video').src = `${baseUrl}/process_video/?video_id=${response.video_id}&confidence=${confidence}`;
                    document.getElementById('display_video').style.display = 'block';
                    document.getElementById('display_image').style.display = 'none';
                } else {
                    console.error('No video ID provided in the response');
                }
            });
            this.on("error", function(file, response) {
                console.error('Error during file upload: ' + response);
            });
        }
    });
</script>

</body>
</html>
